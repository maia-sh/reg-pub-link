---
title: "Linkage of trial registrations and results publications: A cross-sectional, automated evaluation of German university medical centers"
author: "Maia Salholz-Hillel, Daniel Strech, Benjamin Gregory Carlisle"
output: 
  bookdown::word_document2:
    reference_docx: quest-word-template.docx
    latex_engine: xelatex
bibliography: references.bib
editor_options:
    markdown:
        canonical: true
    chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
ggplot2::theme_set(ggplot2::theme_minimal())

library(dplyr)
library(tidyr)
library(stringr)
library(glue)
library(purrr)
library(here)
library(readr)

library(ggplot2)
library(DiagrammeR)
library(gtsummary)
# library(papaja)

# Get data
trials_all <- read_rds(here("data", "processed", "trials.rds"))
# cross_registrations_all <- read_rds(here("data", "processed", "cross-registrations.rds"))
pubmed_all <-
  read_rds(here("data", "processed", "pubmed-main.rds"))

# Source analyses
source(here("R", "functions", "screening.R"))
# # source(here("R", "functions", "report-results.R"))
source(here("R", "analysis", "01_screen-trials.R"))
# # source(here("R", "analysis", "02_flowchart-trials.R"))
source(here("R", "analysis", "03_tbl-trials.R"))
source(here("R", "analysis", "04_link-reg-pub.R"))
# # source(here("R", "analysis", "05_upset-link-reg-pub.R"))
source(here("R", "analysis", "06_plot-change-over-time.R"))
source(here("R", "analysis", "trn-regex-analysis.R"))
source(here("R", "analysis", "cross-registrations.R"))
# # fs::dir_ls(here("R", "analysis")) %>% 
# #   purrr::walk(source)
```

# Abstract

**Objective** To evaluate, using a novel automated approach, the linkage of registrations and results publications across a sample of clinical trials led by German university medical centers (UMCs) and registered in either ClinicalTrials.gov or the German Clinical Trials Registry (DRKS). The International Committee of Medical Journal Editors (ICMJE) and the Consolidated Standards of Reporting Trials (CONSORT) call for transparent registration-publication linkage to promote discoverability of both the clinical trial publication and registration and thus increase the value of clinical research.

**Design** Cross-sectional bibliographic study

**Setting** German UMC clinical trials

**Methods** We used automated strategies to download and extract data from trial registries, PubMed, and trial publications for a cohort of all registered clinical trials conducted across German UMCs and completed between 2009 and 2017. We implemented regular expressions to detect and classify publication identifiers (DOI and PMID) in registrations, and TRNs in publication metadata, abstract, and full-text. <!--# We verified our automated approach on a manually coded sample. -->

**Main outcome measures** The proportion of trial registrations incorporating a structured reference (DOI or PMID) to a known results publication. The proportion of clinical trial results publications that reported the known TRN in the metadata, abstract, and full-text.

**Secondary analyses** We explored<!--# tested --> the relationships between (1) TRN in abstract or full-text, and TRN in PubMed metadata, as well as between (2) TRN in PubMed metadata and publication linkage in the registration. We also explored the relationship between cross-linkage<!--# practices --> and registry. We also explored the relationship between cross-linkage<!--# practices --> and prospective registration <!--# not sure about this. i think if we do this then glm for the various practices -->. We looked at change in registration-publication linkage over time. We also looked at cross-registrations in the registries as well as additional TRNs reported in trial publications.<!--#  We also looked at reporting PMC-version full-text. We also looked at reporting rates by UMCs, randomized controlled trials (RCTs), and ICMJE-status. We also explored the association of TRN reporting practices with other responsible trial research practices, namely prospective registration and summary results reporting. All analyses are exploratory. -->

**Results** Of `r n_trials_ft_pdf` trials with PubMed-indexed clinical trial results publications available as full-text, we found `r report_n_pct_trials(n_trials_link_full)` trials with comprehensive registration-publication linkage, meaning a linked publication (DOI or PMID) in the registration as well as the TRN in the publication full-text, abstract, and metadata. In contrast, we found `r report_n_pct_trials(n_trials_link_none)` trials with no links. We found that only `r report_n_pct_trials(n_trials_link_reg_drks, n_trials_drks)` of DRKS trials referenced the results publication in the registration, whereas `r report_n_pct_trials(n_trials_link_reg_ctgov, n_trials_ctgov)` of ClinicalTrials.gov trials did so, mostly via automatic publication indexing. TRNs were most commonly reported in the full-text, appearing in `r report_n_pct_trials(n_trials_link_trn_ft)`. Linkage rates appear overall lower for DRKS trials than for ClinicalTrials.gov. The most common link is TRN reporting in the full-text which reached `r stringr::str_extract(report_link_year("TRN (Full-text)", 2017), "\\d{2}%")` in 2017 in both registries. <!--# add more secondary? -->

**Conclusion** Despite encouragement from CONSORT and ICMJE, German UMCs have not comprehensively linked trial registrations and publications by both including a structured reference to the publication in the registration, and reporting TRNs in results publications. Publication linkage was noticeably greater in ClinicalTrials.gov which uses a more structured data entry process as well as automatically indexes publications from PubMed. German and international university medical centers (UMCs) should incentivize, promote, and educate their researchers on this responsible research practice. Automated strategies, such as those used in this study, could support bibliometric databases and registries to enrich their registration-publication linkage. For example, to improve TRN inclusion in its metadata, PubMed could automatically extract TRNs from publication abstracts or full-text. DRKS could adopt strategies like those used by ClinicalTrials.gov to automatically index publications reporting the TRN in PubMed. As compared with other responsible research practices (such as trial registration itself), reporting TRN and publications are copy-and-paste tasks that may be integrated into biomedical researchers' existing workflows.

**Registration** This study was not preregistered. <!--# The study protocol is available at [insert link]. -->

**Open Data and Code** All code and the final analysis data for this study are available at [insert link]. Raw data (with the exception of the full-text of publications) is available at [insert link].

# Introduction

Clinical trial registration and results reporting are important tools for clinical research transparency [@worldmedicalassociation2013; @worldhealthorganization2017].<!--# I removed background on registration and results reporting for succinctness and because there's a robust literature, which I can add additional citations to. Let me know if you think it's worth adding back a few sentence of background. --> Linkage of the trial registrations and results publications promotes discoverability of both components <!--# adds further transparency beyond registration and results reporting independently -->and increases the value of clinical research. Such threaded evidence <!--# Linked registrations-publications-->empowers readers to cross-check sources, e.g., for potential outcome switching [@altman2014t], and can support systematic reviewers who rely on registrations to supply additional trial information for evidence synthesis [@miron2020sd]. Robust linkage includes both the incorporation of a structured reference to publications in the registration, and reporting of trial registration numbers (TRN) in the full-text, abstract, and metadata of publications.

The Consolidated Standards of Reporting Trials (CONSORT) as well as the ICMJE's *Recommendations for the Conduct, Reporting, Editing, and Publication of Scholarly Work in Medical Journals* call for reporting "trial registration number and name of the trial register" in both the full-text and abstract of trial results publication [@internationalcommitteeofmedicaljournaleditorsicmje2019; @hopewell2008pm]. Reporting TRN solely in the full-text does not suffice since readers may not have access to the full-text or may base their judgment of the trial or topic on the abstract alone [@hopewell2008tl]. Abstracts may also be published independently of a full-text publication, such as for conference abstracts, highlighting the need for TRN reporting in abstracts as well [@hopewell2008pm].

Furthermore, the inclusion of TRNs in publication and bibliographic metadata enhances discoverability for both human readers and computerized analysis. For example, PubMed MEDLINE metadata includes TRNs under the "secondary source id" tag [@nationallibraryofmedicine2018], which can then be searched on the web interface (e.g., "NCT00002568[secondary identifier]" or "NCT00002568[si]") or accessed programmatically via the underlying XML [@nationallibraryofmedicine2017c]. Currently, these tags can be generated from publisher-provided data or assigned manually by NLM Indexing Data Reviewers who copy-and-paste secondary source ids (including trial ids) found in the abstract and full-text (personal communication via NLM Helpdesk Ticket CAS-552810-T3H7V5). <!--# @daniel: this had been in the intro but you said to shorten so i moved to discussion but then you had several quetion about how SI is made, so moved it back to intro... -->

Machine-readable TRN metadata moreover facilitates automatic incorporation of the publication in the registry for "easy linking of trial related publications with clinical trial registry site records" [@nationallibraryofmedicine2017c]. For example, ClinicalTrials.gov uses PubMed secondary identifiers to automatically index publications in the registry entry under "Additional publications automatically indexed to this study by ClinicalTrials.gov Identifier (NCT Number)" [@nationallibraryofmedicine2017c]. This therefore increases the discoverability of the publication from the registration, with no additional effort from the trial investigator for manually adding the publication to the registry.

Such references to results publications within a registration allow readers to quickly identify and navigate to the trial findings. <!--# add policy background on why pub in reg --> The insertion and structuring of references depends on the registry; whereas ClinicalTrials.gov includes both automatically indexed publications and manual entries in quasi-structured datafields, DRKS currently accepts only manual entries in minimally structured datafields. References, like those automatically indexed, may include one or more publication unique identifier such as a DOI or PMID, or may be limited to a free-text citation with journal, article, and author names, but no unique identifier. While readers of the registry may be able to find the referenced publication from the free-text, unique identifiers provide a more robust and structured link that allows for automated retrieval and linkage [@huser2013po].

Trial evidence appears to be insufficiently linked in both registries and publications. @huser2013po found that only 28% of 8907 completed trials contained a structured trial-article link with a publication unique identifier in the registry. In a systematic review of 16 studies examining cohorts of trial publications for links to registrations<!--# of results publications with associated registrations/investigating linked registrations-publications in publication cohorts found via both automated and manual approaches...couldn't find the overall TRN reporting rate from all studies looking at TRN, only the 16 using both automated and manual approaches, but this level of detail feels like too much to explain -->, @bashir2017sr found an overall rate of 49% of results publications <!--# (range: 8-97%) --> reported a TRN in either the metadata, abstract, or full-text. More recently, @carlisle2020m found 38,001 ClinicalTrials.gov ids across 488,365 abstracts from records indexed by PubMed as clinical trial publications, meaning a maximum of `r round(38001/488365 * 100, digits = 1)`% of publications report a ClinicalTrials.gov id, assuming one TRN per publication. @aldurra2020b found that only 28.8% (7473/10,500) records classified as RCTs based on a bespoke PubMed query reported trial ids in any of the metadata, abstract, or full-text. <!--# @murph sanity check of numbers from other papers -->

These previous projects, however, faced limitations due to the unclear publication cohort and unknown true registration rates. PubMed queries currently do not suffice to identify the true populations of clinical trials or even RCTs, both excluding true positives (i.e., sensitivity) and including false positives (i.e., specificity) [@glanville2020jmla]. Therefore not all PubMed-indexed clinical trials or RCTs should be registered <!--# as they may not reflect true clinical trials or RCTs -->, and not all that should be are. Furthermore, not all reported TRNs correspond to bona fide registrations of trial whose results are reported in the publication, i.e., TRNs may be reported for related trials in the background section. As such, conclusions drawn by these previous studies relying on PubMed-query based samples, about registration reporting rates must be qualified as the rate of reported trial registration numbers in PubMed-indexed (randomized) clinical trials with unknown registration rates. <!--# remove previous sentence? --> In addition, registry-based cohorts have included trials that may not have an associated publication and thus should not be expected to have a publication link. These studies of publication linkage in registrations have furthermore focused on ClinicalTrials.gov [@huser2013po; @huser2012; @goodwin2018], and we are not aware of other studies investigating publication linkage in DRKS.

## Objectives

We evaluated the linkage of registrations and results publications across a sample of clinical trials led by German university medical centers (UMCs) and registered in either ClinicalTrials.gov or the German Clinical Trials Registry (DRKS) with completion dates between 2009 and 2017. <!--# @daniel comment: add reference to intovalue here? it's in methods -->We also looked at change in these linkage practices over time. By relying on a cohort of known trial registrations and publications, we are able to draw conclusions about registration-publication linkage, both with regards to the rate of structured links to known results publications in its registration, and the rate of reporting a trial's known TRN in its publication full-text, abstract, and metadata. We use an automated and scalable approach for data collection and extraction using regular expressions for the detection and classification of publication identifiers and TRNs. We did not pre-specify the analyses.

<!--# We also explored the reporting of additional TRNs, beyond the known associated TRN, in publications, including reported cross-registrations, meaning more than one TRN in more than one registry associated with a single publication. We also looked at reporting PMC-version full-text.  -->

# Methods

## Data sources and collection

We used two cohorts of registered clinical trials and associated results previously developed by @wieschowski2019joce and @riedel2021 and referred to as the "IntoValue" dataset. In brief, the dataset consists of clinical trials registered on ClinicalTrials.gov or the German Clinical Trials Registry (DRKS) and conducted at a German UMC completed between 2009 and 2017, and results publications found via manual searches.

We <!--# programmatically -->downloaded data from both registries on 15 May 2021. We fetched additional fields needed for our analysis, such as references, as well as refreshed the fields previously included in our source trial datasets to ensure parity between the two trial cohorts and current registry data. We queried ClinicalTrials.gov using the Clinical Trials Transformation Initiative (CTTI) Aggregate Content of ClinicalTrials.gov (AACT) via its PostgreSQL database API [@clinicaltrialstransformationinitiativectti]. As DRKS does not provide an API, we built a webscraper to capture the necessary fields [@federalinstitutefurdrugsandmedicaldevicesbfarm]. ClinicalTrials.gov requires more structured data input compared with DRKS; we attempted to tidy the DRKS output to extract additional information. For example, ClinicalTrials.gov has a separate summary results reporting section, whereas summary results are included with other references in DRKS. We inferred summary results based on common terminology (e.g., "study results", "Ergebnisbericht", "Abschlussbericht", "Studienergebnisse"). <!--# remove if not including summary results -->

We then queried the PubMed Entrez Programming Utilities (E-utilities) API via an R client for all trial results PMIDs, and excluded PMIDs that did not resolve [@usnationallibraryofmedicinetigtand; @winter]. From the PubMed XML, we extracted bibliometric information, including the publication abstract and secondary identifier (or databank) metadata, as well as MeSH terms, keywords, author details, and summary metadata. <!--# remove unused pubmed components? -->

We used DOIs and PMIDs to search for full-text publications as PDFs, using a combination of automated and manual strategies, including contacting the corresponding author as a final step <!--# add that this was just for a few studies? --> [@ourresearch; @jahn]. We then used the GROBID machine learning library for technical and scientific publications to parse the PDFs into machine-readable XMLs [@2008]. In order to isolate the main body from the publication abstract for our analysis, we extracted the `<body>` sections of the papers.

Figure \@ref(fig:flow-methods) show the methods flow using automated techniques with the exception of some full-text PDFs.

```{r flow-methods, fig.cap = "Data collection sources and methods", out.width="50%"}
knitr::include_graphics(here("docs", "figures", "flow-methods.png"))
```

### Exclusion/inclusion criteria

After updating registry data, we reapplied the IntoValue exclusion criteria to exclude trials that were completed before 2009 or after 2017, were non-interventional, or did not meet the recruitment or study status inclusion criteria (see @wieschowski2019joce and @riedel2021 for further details on these criteria). We also excluded trials without a German UMC lead, as only one of the two IntoValue cohorts included trials not led by German UMCs. For duplicate trials (i.e., appearing in both IntoValue cohorts), we excluded the earlier record. We also excluded trials without results, and trials with results for which we could not find a PMID and full-text publication.

## Detection and classification of publication identifiers in registrations

As reference data is available in difference formats depending on the registry, we developed parallel approaches to extract publication identifiers for each. For ClinicalTrials.gov, we retrieved the reference type, citation, and PMID fields from AACT. We then used a regular expression (regex) to extract any DOIs from the citations; we did not search for PMIDs as these are captured in an AACT field. For DRKS, we scraped the reference type, citation, and URL link, when available. We used regexes to extract any DOIs and PMIDs from either the citation or link. In the rare cases when conflicting DOIs or PMIDs were found in the citation vs. the link, we manually reviewed to determine which was valid; if both were valid, we preferred the identifier provided in the citation. In addition, we determined whether a reference was manually or automatically indexed in the registry. DRKS allows only manually added references; for ClinicalTrials.gov, references of type "derived" were marked as automatically indexed. We then used DOIs and PMIDs to match the referenced publications to those in our trial dataset. We did not attempt to match publications without identifiers (i.e., publication title only).

## Detection and classification of trial registration numbers in publications

We developed <!--# and evaluated [or more methods details] --> regexes for the TRN patterns for all PubMed-indexed and ICTRP-network registries (see Appendix \@ref(trn-regular-expressions) Table \@ref(tab:tbl-trn-regexes)) <!--# or move to osf protocol or remove from this paper and make separate citation  --> and used these to detect and classify TRNs in the PubMed secondary identifier metadata, abstract, and full-text. To gauge the sensitivity and specificity of these regexes, we visually inspected all PubMed secondary identifier metadata for true positives and true negatives.<!--# In order to isolate the full-text main body from the publication abstract for our analysis, we included only `<body>` sections of the PMC and PDF samples for the full-text source. --> For each source, we first extracted all unique TRN patterns within a source. Our regex allowed for minor formatting errors in the TRN patterns (such as additional punctuation). We then cleaned the TRN patterns to remove these formatting errors, and then deduplicated the corrected TRNs to exclude duplicates within a source introduced through the cleaning process. We also coalesced across sources to deduce a list of unique TRNs by publication along with the source(s) in which each was reported.

The output of this TRN extraction, cleaning, and deduplication included TRNs beyond those of the known registrations. These additional TRNs could be cross-registrations of the same trial or provided as background or discussion. For this study, we were interested in whether known registrations were reported in the publication, so we filtered for reported TRNs matching the known registrations. <!--# change this if considering cross-reg -->

<!--# Using registry APIs, when available, and web scraping, we checked whether each unique TRN resolved to a valid trial registration. currently placeholder "TRUE" such that all TRNs resolve in the registries -->

<!--# Since i'm focusing iv trn only, should i change this section so not ALL the trns? then would have to change my backend work. or can keep this section but maybe not report all the details in text but just appendix? -->

## Software, code, and data

Data collection, preparation, and analysis was performed in R version 4.0.2 (R Foundation for Statistical Computing) and RStudio version 1.4 (RStudio Team). PDF conversion to TEI XML was performed using GROBID Server 0.6.1 [@2008] and GROBID Python Client [@lopez2021]. All code and the final analysis data for this study are available at [insert link]. Raw data (with the exception of the full-text of publications) is available at [insert link].

# Results

## Trial and publication characteristics

The IntoValue trials dataset included the full sample of trials led by a German UMC that were registered on ClinicalTrials.gov or the DRKS and completed between 2009 and 2017 (n = `r n_trials_iv`). After applying our exclusion criteria <!--# excluding non-German UMC-led trials, deduplicating trials, excluding trials without results, enhancing the publication metadata, getting full-text, and excluding trials with results without a PMID and full-text -->, our sample included `r n_trials_ft_pdf` trials with `r n_pubs_unique` unique results publications indexed in PubMed and available as full-text, as some publications include results from more than one trial. Figure \@ref(fig:flow-trials) details the trial and publication screening. Table \@ref(tab:tbl-trials) shows summary descriptive details of the trials with results publications. <!--# QUESTION: what summary info about trials and publications? I also include a long version of demographic data in case we want to include any of these, ideally with collapsed categories, in Table @ref(tab:tbl-trials-full) -->

```{r flow-trials, fig.cap = "Trials and publications screening", out.width="50%", out.height="50%"}
knitr::include_graphics(here("docs", "figures", "flow-trials.png"))
```

```{r tbl-trials}
tbl_trials %>% 
  gtsummary::as_flex_table() %>% 
  flextable::set_caption(caption = "Characteristics of included trials with results publications")
```

## Registration-publication linkage

While per our inclusion criteria all trials in our sample (n = `r n_trials_ft_pdf`) were registered and had a publication, only `r report_n_pct_trials(n_trials_link_full)` trials had the most comprehensive registration-publication linkage, meaning a linked publication in the registration as well as the TRN in the publication full-text, abstract, and metadata. In contrast, we found `r report_n_pct_trials(n_trials_link_none)` trials with no links in either the registration or the publication. Figure \@ref(fig:plot-upset-links-reg-pub-registries) shows the breakdown of registration-publication linkage across the various components for ClinicalTrial.gov and DRKS trials.

```{r plot-upset-links-reg-pub-registries, fig.cap = "Registristion-publication linkages in ClinicalTrials.gov and DRKS", out.width="80%"}
knitr::include_graphics(here("docs", "figures", "plot-upset-links-reg-pub-registry.png"))
```

### Publications linked in registrations

We found that `r report_pct_num_denom_trials(n_trials_link_reg)` registrations included a reference with a publication identifier (DOI or PMID) to the associated publication in our sample of trials with published results. Only `r report_pct_num_denom_trials(n_trials_link_reg_drks, n_trials_drks)` of DRKS trials referenced the results publication in the registration, in contrast with `r report_pct_num_denom_trials(n_trials_link_reg_ctgov, n_trials_ctgov)` of ClinicalTrials.gov trials, of which `r report_pct_num_denom_trials(n_trials_ctgov_link_reg_trn_si_derived, n_trials_link_reg_ctgov)` were automatically indexed.

<!--# @daniel: you had several comments about automatically linked pubs so I don't think the language I had was clear. I tried several wordings below. Let's discuss and figure out what is clearest. -->

Of ClinicalTrials.gov trials with the TRN in the PubMed metadata (n = `r n_trials_ctgov_link_reg_trn_si`), `r report_n_pct_trials(n_trials_ctgov_link_reg_trn_si_manual + n_trials_ctgov_no_link_reg_trn_si, n_trials_ctgov_link_reg_trn_si)` were not automatically indexed.

Of ClinicalTrials.gov trials with the TRN in the PubMed metadata (n = `r n_trials_ctgov_link_reg_trn_si`), `r report_n_pct_trials(n_trials_ctgov_link_reg_trn_si_derived, n_trials_ctgov_link_reg_trn_si)` have the publication automatically linked in the registry, `r report_n_pct_trials(n_trials_ctgov_link_reg_trn_si_manual, n_trials_ctgov_link_reg_trn_si)` have the publication manually linked in the registry, and only `r report_n_pct_trials(n_trials_ctgov_no_link_reg_trn_si, n_trials_ctgov_link_reg_trn_si)` trial is not linked in the registry.

All `r n_trials_ctgov_link_reg_trn_si_derived` trials with automatically indexed publications in ClinicalTrials.gov include the TRN in the PubMed metadata. An additional `r n_trials_ctgov_link_reg_trn_si_manual` trials include the TRN in the PubMed metadata and a link publication that was not automatically indexed, as it may have been entered by the trialist manually prior to being indexed. `r if (n_trials_ctgov_no_link_reg_trn_si == 1) "Only one"` ClinicalTrials.gov trial (NCT01614301) has a TRN in the PubMed metadata (PMID: 26417987) and no linked publication in the registration. While the TRN is indeed indexed in the secondary identifier field, PubMed mistakenly associated it with an incorrect databank (i.e., GENBANK) which presumably prevented ClinicalTrials.gov from making the link.

When limiting to only manually linked publications in the registration, performance is similar between ClinicalTrials.gov (24%, 186/783) and DRKS (22%, 96/447). <!--# change to code -->

### Registrations linked in publications

We found that `r report_pct_num_denom_trials(n_trials_link_trn_none)` trials did not report the known TRN in any of the metadata, abstract, or full-text of the corresponding publication. Only `r report_pct_num_denom_trials(n_trials_link_trn_all)` reported the TRN across all three locations. TRNs were most commonly reported in the full-text, appearing in `r report_n_pct_trials(n_trials_link_trn_ft)`. TRNs were included in `r report_n_pct_trials(n_trials_link_trn_abs)` of abstracts, as compared with `r report_n_pct_trials(n_trials_link_trn_si)` of PubMed metadata.

### Linkage by registry

We found that trials with a ClinicalTrials.gov TRN were significantly more likely than trials with a DRKS TRN to include a publication reference in the registry (`r apa::apa(chisq_link_by_reg_reg, print_n = TRUE)`) and to include the TRN in the PubMed metadata (`r apa::apa(chisq_link_by_reg_si, print_n = TRUE)`) and abstract (`r apa::apa(chisq_link_by_reg_abs, print_n = TRUE)`). We did not find a significant relationship between registry and TRN reporting in full-text (`r apa::apa(chisq_link_by_reg_pdf, print_n = TRUE)`). Table \@ref(tab:tbl-link-by-reg) shows summary registration-publication linkage by registry.

<!--# point estimtes in table should have CI, right? -->

```{r tbl-link-by-reg}
tbl_link_by_reg %>% 
  gtsummary::as_flex_table() %>% 
  flextable::set_caption(caption = "Registration-publication linkage by registry")
```

### TRN reporting in PubMed metadata

<!--# @daniel asked me to test relationship between trn in metadata and abs/ft. many options. total in abs 714 and ft 1131. chisquare trn reporting abs given diff combos of abs/ft reporting OR just abs or ft? ideally, compare registry, trn in abs/ft (not sure what levels), and trn in si, but 3 variable so not chisquare-->

For the 1,372 trials that provided a TRN in either the abstract or full-text, a TRN was also available in the metadata in 55% (n = 767). ClinicalTrials.gov TRNs (65%, 705/1077) were more likely than DRKS TRNs (21%, 62/295) to be included in PubMed metadata. Furthermore, 97% (563/580) of trials with a ClinicalTrials.gov TRN in the abstract also had the TRN in the PubMed metadata, compared with 23% (31/134) of trials with a DRKS TRN. Similarly, 58% (507/878) of trials with a ClinicalTrials.gov TRN in the full-text also had the TRN in the PubMed metadata, compared with 18% (48/253) of trials with a DRKS TRN.

A chi-square test of independence was performed to examine the relation between registry and TRN in PubMed metadata, for trials with TRN reported in both the abstract and the full-text. The relation between these variables was significant, X2 (1, N = 473) = 201.0, p = 1.07e-45. Trials with a ClinicalTrials.gov TRN (Proportion with TRN in SI = 95.5%) were more likely than trials with a DRKS TRN (Proportion with TRN in SI = 33.7%) to have a TRN in PubMed metadata if reported in both the abstract and the full-text (Difference in reporting = 61.8%, CI = 52.5, 71.4).

### TRN reporting given prospective registration

<!--# Are TRNs reported more or less often in abstract OR full text for prospective or retrospective registrations? -->

A chi-square test of independence was performed to examine the relation between prospective registration and TRN reporting in either the abstract or the full-text (abstract-only, full-text-only, both, neither). Registration was categorized as prospective if the trial was registered in the same or preceding months to trial start, since trial start on ClinicalTrials.gov is sometimes available with month and year only. Two trials (NCT02127736, NCT02213406) without start dates and were excluded from this analysis as we could not determine whether registration was prospective. The relation between these variables was significant, X2 (1, N = 1894) = 22.8, p = .00000182. Prospectively registered trials (Proportion reporting = X) were more likely than retrospectively registered trials (Proportion reporting = X) to report the TRN in either the abstract and/or the full-text (Difference in reporting = X, CI = X, X).

### Change in registration-publication linkage over time, by registry

Linkage rates appear overall lower for DRKS trials than for ClinicalTrials.gov. Overall, we observed positive trends for TRN reporting in full-text and abstracts. <!--# add test? --> Figure \@ref(fig:plot-links-year-reg) shows the registration-publication linkages over time for ClinicalTrials.gov and DRKS.

```{r plot-links-year-reg, fig.cap = "Change over time in registration-publication linkages in ClinicalTrials.gov and DRKS. Completion year from registry."}
knitr::include_graphics(here("docs", "figures", "plot-links-year-reg.png"))
```

## Cross-registrations

We found `r report_pct_num_denom_trials(n_trials_crossreg_reg)` of trials indicated a total of `r n_crossreg_reg` cross-registrations as secondary identifiers in their registrations. Of these `r n_crossreg_reg` cross-registrations, X were reported in pubs (X in metadata, X in abs, X in ft). Beyond the IntoValue primary TRNs and these registry-indicated cross-registrations, we detected X additional TRNs in X publications. Table \@ref(tab:tbl-crossreg) shows details on cross-registrations and additional TRNs by registry.

```{r tbl-crossreg}
tbl_crossreg %>% 
  gtsummary::as_flex_table() %>% 
  flextable::set_caption(caption = "Cross-registrations and additional TRNs by registry")
```

## Evaluation of TRN regular expressions

<!--# TODO: add to methods if this is staying? -->

To gauge the sensitivity and specificity of the TRN regexes, we visually inspected all PubMed secondary identifiers extracted for our sample (n = `r nrow(si)`). PubMed's secondary identifier field can contain identifiers not only from clinical trial registries, but also from other databanks, such as molecular sequence and gene expression identifiers or open data repository designators (i.e., figshare, Dryad) [@nationallibraryofmedicine2018]. Most ids were clear true positive TRNs (n = `r si_tp` ) and a handful were clear true negative other ids (n = `r si_figshare`) (i.e., figshare). We also found `r si_drks_misformatted` ids which, based on additional PubMed data, we could determine were DRKS ids, but which were so severely misformatted that on visual inspection alone, we did not classify as TRNs (i.e., missing the preceding letters "DRKS" and just a string of numbers such as "00000711"). As such, we consider a true negative of n = `r si_tn`. Our regexes correctly classified all TRNs and non-TRNs, resulting in a sensitivity and specificity of 100%. If we had instead categorized the `r si_drks_misformatted` severely misformatted DRKS ids as true positives, our regexes would have sensitivity of `r style_percent(si_sens_alt, digits = 1)`% and a specificity of `r style_percent(si_spec_alt)`%.

# Discussion

The cross-linkage of trial registrations and results publications plays an important role in research transparency and can substantially increase the value of this resource-intensive area of biomedical research. This responsible practice comes at minimal costs to researchers, on the order of seconds for pasting TRNs in papers and minutes for adding a publication link to the registration.

Our study shows that German UMCs can improve in both TRN reporting in publications and references to publications in the registration. In our sample (n = `r n_trials_ft_pdf`), `r report_n_pct_trials(n_trials_link_none)` trials had no links between registration and publication and only `r report_n_pct_trials(n_trials_link_full)` trials had the most comprehensive registration-publication linkage

The issue of TRN reporting in publications is also reflected in CONSORT and ICMJE guidelines. Only `r report_n_pct_trials(n_trials_link_trn_ft_abs)` trials in our sample fully met the CONSORT and ICMJE guidelines to include TRNs in both the full-text and the abstract. An additional `r report_n_pct_trials(n_trials_link_trn_ft)` report in full-text only and `r report_n_pct_trials(n_trials_link_trn_abs)` did so in the abstract only. This situation indicates that there is much room for improvement, with involvement across stakeholders, from individual trialists and UMCs, to journals, bibliographic databases, and trial registries.

Reporting appears to have increased over our study time in the full-text and abstracts<!--# while an increase in reporting in abstracts seems to lag behind -->. The upward trend suggests this practice is gaining traction, however more slowly than advisable per CONSORT and ICMJE guidelines. Low TRN reporting poses a barrier to identifying trial publications via automated approaches and instead require researchers to perform intensive manual keyword-based searches to match publications to trials [@wieschowski2019joce; @chen2016b; @bashir2017sr].

Trials registered in ClinicalTrials.gov showed better linkage than trials registered in DRKS<!--# or be explicit that not significant for full-text -->. Notably, TRNs in PubMed metadata and publication references in registrations were almost three-fold more frequent in ClinicalTrials.gov than in DRKS.

<!--# n addition to incorporating TRNs provided in publisher data, NLM Indexing Data Reviewers manually assign metadata tags -->

TRNs in PubMed metadata may be either provided by publishers or manually assigned by National Library of Medicine (NLM) staff who copy-and-paste TRNs found in the abstract and full-text (personal communication via NLM Helpdesk Ticket CAS-552810-T3H7V5). As such, we would expect similar rates of TRNs in PubMed metadata across registries for trials with a TRN in abstract or full-text. However, even when limiting to trials with a TRN in abstract or full-text, ClinicalTrial.gov TRNs are more likely than DRKS TRNs to be included in the PubMed metadata. This suggests that NLM staff are more attentive to ClinicalTrial.gov TRNs and that DRKS TRNs more often go unnoticed in their manual labor. This is supported by our finding that TRNs were more likely to be included in PubMed metadata for ClinicalTrials.gov than DRKS trials with their TRN in the abstract or full-text. Futhermore, it appears that NLM staff may be more attentive to abstracts than to full-text, since almost all trials with ClinicalTrials.gov TRNs in the abstract, but only about half of those with ClinicalTrials.gov TRNs in the full-text, had the TRN in the metadata.

The almost three-fold discrepancy in the rates of publication references in registrations is driven by automatic indexing of trial publications based on TRNs in the PubMed metadata. ClinicalTrials.gov uses PubMed metadata to automatically link publications, whereas DRKS currently allows only for manual submission of references by trialists. When limiting to manually submitted publication references in registrations, performance across registries is comparable.

Accurate TRN formatting in publication data is critical for machine-readability, which in turn enables automated indexing of publications in the registration. While our regular expressions allow for and correct minor formatting errors (such as erroneous punctuation), egregious misformatting may make the TRN undetectable. For example, in our visual inspection of the PubMed metadata TRNs, we found `r si_drks_misformatted` severely misformatted DRKS TRNS (i.e., numbers only with no preceding letters), which we could only identify as DRKS TRNs using additional metadata and which prevented the regex classifying them as TRNs based on the pattern alone. Classifying these cases as true negative, our regexes correctly classified all TRNs and non-TRNs in our sample's the PubMed metadata secondary identifier field (sensitivity and specificity of 100%).<!--# remove since not about trn formatting alone? Futhermore, ClinicalTrials.gov presumably relies not only on the reported TRN but also on the registry, and as such failed to index a publication (PMID: 26417987) despite the TRN (NCT01614301) appearing in the PubMed metadata, as the associated databank was incorrect (i.e., GENBANK). -->

We detected X TRNs in PubMed metadata, abstracts, and full-text which did not correspond to either the associated trial's IntoValue TRN or a cross-registration listed on the registry. While the TRNs in the PubMed metadata (n = X) and abstracts (n = X) are likely supplemental cross-registrations, the additional TRNs in the full-text may also have been provided as background or discussion. Such discrimination falls beyond the scope of these regexes.

## Strengths and Limitations

This approach has numerous strengths. In contrast with previous studies relying on PubMed queries to identify potential (randomized) clinical trial results publications, we relied on a sample of bona fide results publications from registered trials, allowing us to evaluate the rate of structured links to known results publications in its registration, and the rate of reporting a trial's known TRN in its publication full-text, abstract, and metadata.

We used an automated approach of regular expressions with high sensitivity and specificity to identify and classify publication identifiers and TRNs which allowed for a larger sample size that manual data extraction would have permitted. This study demonstrates the application of an code-based strategy which provides a scalable method for evaluating publication links in registrations and TRN reporting in publications and can be applied to other trial sets.

The approach also faces limitations. Our input IntoValue dataset was limited to German UMC-led trials found on ClinicalTrials.gov and DRKS. It is possible that this sample and its cross-linkage rate do not reflect the broader practices across other registries and/or other countries. Future projects should look at similar multi-national samples of bona fide results publication.

Furthermore, we relied on IntoValue for trial deduplication and bona fide results publications. The dataset may have had a small number of unaccounted for cross-registrations (e.g., DRKS00004156 and NCT00215683) and publications that are not trial results (e.g., DRKS00009565 associated publication is 10.1097/aap.0000000000000573, a systematic review, with many reported TRNs).

Finally, the approach relies quality input text data, and since journal articles are still most commonly distributed as PDFs, parsing errors may reduce text quality. We minimized this risk by relying on GROBID to parse full-text PDFs into XML with the body separated out from the abstract, header, and back. While GROBID algorithms are trained on academic papers and have been used in large-scale bibliometric projects [e.g., @wang2020ac], it does not perfectly classify the full-text main body. As such, TRNs appearing in the main body main be mistakenly excluded and TRNs appearing in the header or back material may be mistakenly included.

## Implications for policy and practice

<!--# The cross-linkage of trial registrations and results publications plays an important role in research transparency and can substantially increase the value of this resource-intensive area of biomedical research. This responsible practice comes at negligible costs to researchers, on the order of seconds for pasting TRNs in papers and minutes for adding a publication link to the registration. Our study shows that German UMCs can improve in both TRN reporting in publications and references to publications in the registration. While TRN reporting has improved gradually over the past decade, the rate of change is insufficient and demands a systemic change in practices across the scientific ecosystem to improve this good scientific research practice. -->

This study reveals shortcomings in the cross-linkage of German UMC-led trials registrations and results publications and highlights several promising avenues forward. In contrast with other responsible clinical research practices (such as data protection or trial registration itself), registration-publication cross-linkage is relatively straightforward and can be improved with action across stakeholders. Researchers should comply with CONSORT and ICMJE and include the TRN in their publication full-text and abstract. Research institutions like UMCs can facilitate this behavior by educating, supporting, and incentivizing their scientists to adopt this practice. For example, ethics review offices or UMC-core facilities for clinical research could provide researchers a reminder sheet with trial registration and reporting guidelines when reviewing trials. Additionally, *Leistungsorientierte Mittel (LOM)* or bonuses could be disseminated for trial registration, reporting, and reporting of registration. Publishers could check for correctly formatted TRNs for all submitted trial results publications, either via manual review or through simple software such as the regular expressions used for this study. As some already do, journals and preprint servers could also include a separate TRN metadata field during manuscript submission and could provide this data to PubMed and other bibliographic databases. The National Library of Medicine relies on publisher-provided data and manual indexers to create the TRN PubMed metadata if the TRN appears in the abstract or full-text. PubMed and other bibliographic databases could extend and semi-automate these methods in order to detect more TRNs by integrating regex-based software at least to flag potential TRNs which can then be verified by manual indexers if desired. Registries can support cross-linkage by highlighting the correct TRN formatting on their websites and by reminding researchers to include their TRN in publications and link their publication in the registration. Furthermore, they could adopt an automated linking approach using PubMed metadata, similar to that used by ClinicalTrials.gov. Figure \@ref(fig:flow-discussion) shows a process diagram of potential actions to improve registration-publication linkage from stakeholders across clinical research.

With improved TRN inclusion in bibliographic metadata and increased automatic indexing of publications based on this metadata, full cross-linkage could be achieved with negligible work by researchers: simply pasting the TRN into the publication abstract and full-text. In our sample alone, an additional `r report_pct_num_denom_trials(n_trials_link_trn_ft_or_abs_no_si, n_trials_link_trn_ft_or_abs)` of trials with TRN in abstract or full-text could have the TRN included in PubMed's metadata, and `r report_pct_num_denom_trials(n_trials_drks_trn_si_not_linked_pub, n_trials_drks)` of DRKS trials with TRN in the PubMed metadata could be automatically indexed in the registration.

```{r flow-discussion, fig.cap = "Cross-linkage of registrations and publications across the clinical research ecosystem"}
knitr::include_graphics(here("docs", "figures", "flow-discussion.png"))
```

# Acknowledgments

[TO ADD]

# Funding

This work was funded under a grant from the Federal Ministry of Education and Research of Germany (Bundesministerium für Bildung und Forschung - BMBF) [insert grant number]. The funder had no involvement in the study design, data collection, analysis, or interpretation, writing of the manuscript, or the decision to submit for publication.

# Author disclosures

MSH, BGC, and DS declare they have no direct conflict of interest related to this work. MSH is employed as a researcher under the project funding and additional grants from the German Bundesministerium für Bildung und Forschung (BMBF). DS is a member of the Sanofi Advisory Bioethics Committee and receives an honorarium for his contribution to meetings. <!--# BGC? -->

# References {.unnumbered}

::: {#refs}
:::

# (APPENDIX) Appendix {.unnumbered}

# TRN Regular Expressions

```{r tbl-trn-regexes}
ctregistries::registries %>% 
  select(
    Registry = registry,
    "Registry Title" = databank_full_name,
    "TRN Regex" = trn_regex
  ) %>% 
  flextable::flextable(cwidth = 2) %>% 
  flextable::set_caption(caption = "Trial registration number regular expressions")
```
